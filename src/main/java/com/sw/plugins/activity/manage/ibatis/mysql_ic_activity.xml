<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
	"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="activity">
    
    <parameterMap type="com.sw.plugins.activity.manage.entity.Activity" id="activity"/>
    
    <resultMap type="com.sw.plugins.activity.manage.entity.Activity" id="activityResult">
        <result property="id" column="ID"/>
        <result property="name" column="Name"/>
        <result property="type" column="Type"/>
        <result property="status" column="Status"/>
        <result property="startTime" column="StartTime"/>
        <result property="endTime" column="EndTime"/>
        <result property="description" column="Description"/>
        <result property="url" column="Url"/>
        <result property="templetName" column="TempletName"/>
        <result property="createTime" column="CreateTime"/>
        <result property="modifyTime" column="ModifyTime"/>
        <result property="creatorUserId" column="CreatorUserID"/>
    </resultMap>
    
    <select id="select_paginated_list" resultMap="activityResult" parameterMap="activity">
        select ID, Name, Type, Status, DATE_FORMAT(StartTime,'%Y-%m-%d') as StartTime, DATE_FORMAT(EndTime,'%Y-%m-%d') as EndTime, Url, TempletName
        from IC_Activity
        <where>
            <trim prefixOverrides="and">
	            <if test="type!=null">and Type = ${type}</if>
	            <if test="name!=null and name!=''">and Name like '%${name}%'</if>
            </trim>
        </where>
		order by StartTime desc
		limit ${start},${offset}
    </select>
    
    <select id="select_paginated_count" resultType="long" parameterMap="activity">
        select count(ID)
        from IC_Activity
        <where>
            <trim prefixOverrides="and">
	            <if test="type!=null">and Type = ${type}</if>
	            <if test="name!=null and name!=''">and Name like '%${name}%'</if>
            </trim>
        </where>
    </select>
    
    <select id="select_one" resultMap="activityResult" parameterMap="activity">
        select ID, Name, Type, DATE_FORMAT(StartTime,'%Y-%m-%d') as StartTime, DATE_FORMAT(EndTime,'%Y-%m-%d') as EndTime, Description, Url, TempletName
        from IC_Activity where ID=${id}
    </select>
    
    <insert id="insert" parameterMap="activity">
        insert into IC_Activity
        <trim prefix="(" prefixOverrides="," suffix=")">
            <if test="name!=null and name!=''">,Name</if>
            <if test="type!=null">,Type</if>
            <if test="startTime!=null and startTime!=''">,StartTime</if>
            <if test="endTime!=null and endTime!=''">,EndTime</if>
            <if test="description!=null and description!=''">,Description</if>
            <if test="url!=null and url!=''">,Url</if>
            <if test="templetName!=null and templetName!=''">,TempletName</if>
            ,Status
            ,CreateTime
            ,CreatorUserID
        </trim>
        values
        <trim prefix="(" prefixOverrides="," suffix=")">
            <if test="name!=null and name!=''">,#{name}</if>
            <if test="type!=null">,${type}</if>
            <if test="startTime!=null and startTime!=''">,#{startTime}</if>
            <if test="endTime!=null and endTime!=''">,#{endTime}</if>
            <if test="description!=null and description!=''">,#{description}</if>
            <if test="url!=null and url!=''">,#{url}</if>
            <if test="templetName!=null and templetName!=''">,#{templetName}</if>
            ,1
            ,now()
            ,${creatorUserId}
        </trim>
    </insert>
    
    <update id="update" parameterMap="activity">
        update IC_Activity
        <set>
            <trim prefixOverrides=",">
	            <if test="name!=null and name!=''">,Name=#{name}</if>
	            <if test="type!=null">,Type=${type}</if>
	            <if test="status!=null">,Status=${status}</if>
	            <if test="startTime!=null and startTime!=''">,StartTime=#{startTime}</if>
	            <if test="endTime!=null and endTime!=''">,EndTime=#{endTime}</if>
	            <if test="description!=null and description!=''">,Description=#{description}</if>
	            <if test="url!=null and url!=''">,Url=#{url}</if>
	            <if test="templetName!=null and templetName!=''">,TempletName=#{templetName}</if>
	            ,ModifyTime=now()
            </trim>
        </set>
        where ID=${id}
    </update>
    
    <delete id="delete" parameterMap="activity">
        delete from IC_Activity where ID=${id}
    </delete>
</mapper>