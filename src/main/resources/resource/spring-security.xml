<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:security="http://www.springframework.org/schema/security"
	xmlns="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans	
	http://www.springframework.org/schema/beans/spring-beans-3.1.xsd	
	http://www.springframework.org/schema/security	
	http://www.springframework.org/schema/security/spring-security-3.0.xsd"
	default-lazy-init="true">
	<!--<security:global-method-security secured-annotations="enabled" jsr250-annotations="enabled"/> -->
	<!-- auto-config 自动配置常用的权限控制机制 -->
	<!-- servlet-api-provision 禁止保存登录之前的请求 -->
	<!-- access-denied-page 访问未授权时的显示页面 -->
	<security:http auto-config="true" access-decision-manager-ref="accessDecisionManager" access-denied-page="/httpError/403.jsp">
		<!-- 不过滤图片等静态资源，其中**代表可以跨越目录，*不可以跨越目录。 -->
	  	<security:intercept-url pattern="/**/common/**" filters="none" />
		<security:intercept-url pattern="/index" filters="none"/>
		<security:intercept-url pattern="/exit" filters="none"/> 
		<security:intercept-url pattern="/error" filters="none"/> 
		<security:intercept-url pattern="/loginVerify" filters="none"/> 
		<security:intercept-url pattern="/seatcenter**" access="PERMIT_All"/>
        <security:intercept-url pattern="/message/notice/uploadfile" filters="none" />
        <security:intercept-url pattern="/extension/youku_upload/upload_file" filters="none" />
		<!-- login-page 登录页面 -->
		<!-- default-target-url 登录成功后跳转的URL -->
		<!-- always-use-default-target 是否登录后必须访问default-target-url -->
		<!-- authentication-failure-url 登录失败后跳转的URL -->
		<security:custom-filter before="FILTER_SECURITY_INTERCEPTOR" ref="filterSecurityInterceptor" />
		<security:form-login authentication-failure-url="/error" login-page="/index" default-target-url="/main" always-use-default-target="true" />
		<security:logout invalidate-session="true" logout-success-url="/exit" logout-url="/logout" />
		<security:remember-me key="e37f4b31-0c45-11dd-bd0b-0800200c9a66" />
		<security:session-management invalid-session-url="/exit" session-authentication-error-url="/exit">
			<security:concurrency-control error-if-maximum-exceeded="false" expired-url="/exit" max-sessions="1" />
		</security:session-management>
	</security:http>
   	
   	<bean id="securityUserDetails" class="com.sw.core.security.SecurityUserDetails"  />
   	
	<security:authentication-manager alias="authenticationManager">
		<security:authentication-provider user-service-ref="securityUserDetails">
			<security:password-encoder hash="md5" />
		</security:authentication-provider>
	</security:authentication-manager>
	<!-- <bean id="accessDecisionManager" class="org.springframework.security.access.vote.AffirmativeBased"> 
		<property name="decisionVoters"> <list> <bean class="org.springframework.security.access.vote.RoleVoter"> 
		<property name="rolePrefix" value="PMS_"/> </bean> <bean class="org.springframework.security.access.vote.AuthenticatedVoter"/> 
		</list> </property> </bean> -->
	<bean id="filterSecurityInterceptor" class="org.springframework.security.web.access.intercept.FilterSecurityInterceptor">
		<property name="authenticationManager" ref="authenticationManager" />
		<property name="accessDecisionManager" ref="accessDecisionManager" />
		<property name="securityMetadataSource" ref="securityMetadataSource" />
		
	</bean>
	<bean id="accessDecisionManager" class="com.sw.core.security.MyAccessDecisionManager" />
	<bean id="securityMetadataSource" class="com.sw.core.security.MySecurityMetadataSource"/>
</beans>
